<html>
<body>

<style>
  .button-container {
    text-align: center;
    margin-top: 15px;
  }

  .button-container .btn {
    color: black;
    border: thin black solid;
  }
</style>
<div>
  <div id="map" style="width:100%;height:400px;"></div>
  <button id="stamp-btn">Start stamping</button>

  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.52.0/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.52.0/mapbox-gl.css' rel='stylesheet'/>
  <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.0.9/mapbox-gl-draw.css' type='text/css'/>
  <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.0.9/mapbox-gl-draw.js'></script>
  <!--<script type="text/javascript" src='https://rawgit.com/nifty10m/mapbox-gl-draw-stamp-mode/master/dist/index.js'></script>-->
  <script type="text/javascript" src='./dist/modes/stamp-mode.min.js'></script>

  <script type="text/javascript">

      mapboxgl.accessToken = 'pk.eyJ1IjoidGVtcHJhbm92YSIsImEiOiJjaWd0c3M2MW4wOHI2dWNrbzZ5dWo1azVjIn0.x5sm8OjRxO9zO_uUmxYEqg';
      var map = new mapboxgl.Map({
          container: 'map', // container id
          style: 'mapbox://styles/mapbox/streets-v9', // stylesheet location
          center: { lat: 51.27577393881535, lng: 10.707858561480293 },
          zoom: 4.4,
      });

      var geojson = {"type": "FeatureCollection","features": [{"type": "Feature","properties": {},"geometry": {"type": "Polygon","coordinates": [[[-42.890625,59.355596110016315],[-52.03125,52.908902047770255],[-43.59375,25.799891182088334],[-29.8828125,16.636191878397664],[-13.7109375,17.644022027872726],[11.6015625,32.24997445586331],[18.28125,47.754097979680026],[-1.0546875,58.99531118795094],[-21.796875,61.60639637138628],[-42.890625,59.355596110016315]]]}},{"type": "Feature","properties": {},"geometry": {"type": "Polygon","coordinates": [[[-61.87499999999999,56.75272287205736],[-69.60937499999999,38.8225909761771],[-62.22656249999999,30.44867367928756],[-46.05468749999999,32.54681317351514],[-35.859375,39.639537564366684],[-37.265625,52.482780222078226],[-39.0234375,60.930432202923335],[-41.1328125,65.2198939361321],[-58.35937499999999,59.355596110016315],[-61.87499999999999,57.89149735271034],[-61.87499999999999,56.75272287205736]]]}}]};

      var draw = new MapboxDraw({
          defaultMode: 'simple_select',
          displayControlsDefault: false,
          modes: Object.assign({
              'stamp': StampMode,
          }, MapboxDraw.modes),
      });
      map.addControl(draw);

      map.on('load', function () {
          var url = "https://nifty10m.github.io/mapbox-gl-draw-stamp-mode/germany.geojson";
          map.addSource('germany', { type: 'geojson', data: url });
          map.addLayer({
              id: 'germany',
              source: 'germany',
              type: 'line',
              paint: {
                  'line-color': '#ffffff',
                  'line-width': 3
              }
          });

          map.on('sourcedata', (event) => {
              if (event.sourceId === 'germany' && event.sourceDataType !== 'metadata' && event.isSourceLoaded) {
                var features = map.querySourceFeatures('germany');
                draw.changeMode('stamp', {
                    baseFeatureCollection: {
                        type: 'FeatureCollection',
                        features: features,
                    }
                });

                document.getElementById('stamp-btn').addEventListener('click', function() {
                    draw.changeMode('stamp', {
                        baseFeatureCollection: {
                            type: 'FeatureCollection',
                            features: features,
                        }
                    });
                });
              }
          });

          map.on('draw.stamped', function(event) {
              map.getSource('germany').setData({
                  type: 'FeatureCollection',
                  features: event.features,
              });
          });

          map.on('draw.error', function(error) {
              console.log('stamp error', error);
          });
      });

  </script>
</div>

</body>
</html>
